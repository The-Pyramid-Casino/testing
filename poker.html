<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>5 Card Poker Game</title>
  <style>
    body { font-family: Arial, sans-serif; background: #17522a; color: #fff; padding: 2em; }
    #game-container { max-width: 700px; margin: 0 auto; background: #223; border-radius: 10px; padding: 20px; box-shadow: 0 0 30px #0008; }
    .hand { display: flex; gap: 12px; margin-bottom: 10px; }
    .card { width: 65px; height: 90px; background: #fff; color: #000; border-radius: 6px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 1.3em; box-shadow: 0 2px 6px #1116; }
    .controls { margin: 1em 0; }
    .hidden { display: none; }
    button { margin: 0 5px; padding: 10px 18px; border: none; border-radius: 5px; background: #3a853b; color: #fff; font-weight: bold; font-size: 1em; cursor: pointer; }
    button:disabled { background: #aaa; cursor: not-allowed; }
    input[type="number"] { width: 70px; font-size: 1em; padding: 4px; border-radius: 3px; border: none; }
    #message { margin: 1em 0; font-size: 1.1em; min-height: 1.2em; }
    .bet-info { font-weight: bold; }
  </style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V9DHVKBD85"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag("js", new Date());

  gtag("config", "G-V9DHVKBD85");
</script>
</head>
<body>
  <div id="game-container">
    <h2>5 Card Poker</h2>
    <div>
      <span class="bet-info">Balance: $<span id="balance">500</span></span>
      <span class="bet-info" style="margin-left:20px;">Current Bet: $<span id="current-bet">0</span></span>
    </div>
    <div class="controls" id="bet-controls">
      <input type="number" id="bet-amount" min="1" max="500" value="10" />
      <button onclick="placeBet()">Place Bet</button>
    </div>
    <div id="message"></div>
    <div>
      <h3>Your Hand</h3>
      <div class="hand" id="player-hand"></div>
      <div class="controls hidden" id="draw-controls">
        <span>Select cards to hold (click to toggle), then:</span>
        <button onclick="drawCards()">Draw</button>
      </div>
    </div>
    <div>
      <h3>Dealer's Hand</h3>
      <div class="hand" id="dealer-hand"></div>
    </div>
    <div class="controls hidden" id="next-controls">
      <button onclick="nextRound()">Next Round</button>
    </div>
  </div>
  <script>
    // Card and deck logic
    const SUITS = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
    const RANKS = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    let deck, playerHand, dealerHand, heldCards, playerBalance = 500, currentBet = 0;
    let gameState = 'bet'; // 'bet', 'draw', 'reveal', 'finished'

    function createDeck() {
      const cards = [];
      for (let suit = 0; suit < 4; suit++) {
        for (let rank = 0; rank < 13; rank++) {
          cards.push({ suit, rank, str: RANKS[rank] + SUITS[suit] });
        }
      }
      for (let i = cards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [cards[i], cards[j]] = [cards[j], cards[i]];
      }
      return cards;
    }

    function dealHand() {
      return [deck.pop(), deck.pop(), deck.pop(), deck.pop(), deck.pop()];
    }

    // Hand evaluation logic
    function evaluateHand(hand) {
      // Helper: counts and sorts
      const counts = Array(13).fill(0);
      const suits = Array(4).fill(0);
      for (const card of hand) {
        counts[card.rank]++;
        suits[card.suit]++;
      }
      const countVals = counts.filter(v => v > 0).sort((a, b) => b - a);
      const isFlush = suits.some(c => c === 5);

      // Straight check
      let sortedRanks = hand.map(c => c.rank).sort((a, b) => a - b);
      let isStraight = false;
      if (sortedRanks[4] - sortedRanks[0] === 4 && new Set(sortedRanks).size === 5) {
        isStraight = true;
      } else if (JSON.stringify(sortedRanks) === JSON.stringify([0, 1, 2, 3, 12])) { // Wheel: A,2,3,4,5
        isStraight = true;
      }

      // Royal Flush
      if (isFlush && isStraight && sortedRanks[0] === 8) return {rank:9, name:"Royal Flush"};
      // Straight Flush
      if (isFlush && isStraight) return {rank:8, name:"Straight Flush"};
      // Four of a Kind
      if (countVals[0] === 4) return {rank:7, name:"Four of a Kind"};
      // Full House
      if (countVals[0] === 3 && countVals[1] === 2) return {rank:6, name:"Full House"};
      // Flush
      if (isFlush) return {rank:5, name:"Flush"};
      // Straight
      if (isStraight) return {rank:4, name:"Straight"};
      // Three of a Kind
      if (countVals[0] === 3) return {rank:3, name:"Three of a Kind"};
      // Two Pair
      if (countVals[0] === 2 && countVals[1] === 2) return {rank:2, name:"Two Pair"};
      // One Pair
      if (countVals[0] === 2) return {rank:1, name:"One Pair"};
      return {rank:0, name:"High Card"};
    }

    // Simple poker payout table (1:1 for pair, up to 250:1 for Royal Flush)
    const PAYOUTS = [1, 1, 2, 3, 5, 10, 20, 50, 100, 250];

    // UI rendering
    function renderHand(hand, containerId, selectable=false) {
      const div = document.getElementById(containerId);
      div.innerHTML = '';
      hand.forEach((card, idx) => {
        let held = heldCards && heldCards[idx];
        let cardDiv = document.createElement('div');
        cardDiv.className = 'card';
        cardDiv.textContent = card.str;
        if (selectable) {
          cardDiv.style.border = held ? '3px solid #3a5' : '2px solid #ccc';
          cardDiv.style.background = held ? '#cfc' : '#fff';
          cardDiv.style.cursor = 'pointer';
          cardDiv.onclick = () => {
            heldCards[idx] = !heldCards[idx];
            renderHand(playerHand, 'player-hand', true);
          };
        }
        div.appendChild(cardDiv);
      });
    }

    function renderDealerHand(faceDown = true) {
      const div = document.getElementById('dealer-hand');
      div.innerHTML = '';
      dealerHand.forEach((card, idx) => {
        let cardDiv = document.createElement('div');
        cardDiv.className = 'card';
        if (faceDown) {
          cardDiv.textContent = idx === 0 ? card.str : 'ðŸ‚ ';
          cardDiv.style.background = idx === 0 ? '#fff' : '#222';
          cardDiv.style.color = idx === 0 ? '#000' : '#fff';
        } else {
          cardDiv.textContent = card.str;
        }
        div.appendChild(cardDiv);
      });
    }

    function setMessage(msg) {
      document.getElementById('message').textContent = msg;
    }

    function updateBalances() {
      document.getElementById('balance').textContent = playerBalance;
      document.getElementById('current-bet').textContent = currentBet;
    }

    // Game logic
    function placeBet() {
      let bet = parseInt(document.getElementById('bet-amount').value, 10);
      if (isNaN(bet) || bet < 1) bet = 1;
      if (bet > playerBalance) bet = playerBalance;
      currentBet = bet;
      playerBalance -= bet;
      updateBalances();

      // Deal cards
      deck = createDeck();
      playerHand = dealHand();
      dealerHand = dealHand();
      heldCards = [false, false, false, false, false];

      gameState = 'draw';
      document.getElementById('bet-controls').classList.add('hidden');
      document.getElementById('draw-controls').classList.remove('hidden');
      document.getElementById('next-controls').classList.add('hidden');
      setMessage('Select cards to hold and click Draw.');
      renderHand(playerHand, 'player-hand', true);
      renderDealerHand(true);
    }

    function drawCards() {
      // Replace unheld cards
      for (let i = 0; i < 5; i++) {
        if (!heldCards[i]) {
          playerHand[i] = deck.pop();
        }
      }
      // Dealer's draw strategy: holds pairs or better, otherwise replaces up to 3 lowest cards
      let dealerEval = evaluateHand(dealerHand);
      let dealerHeld = [false, false, false, false, false];
      let dCounts = Array(13).fill(0);
      dealerHand.forEach(card => dCounts[card.rank]++);
      // Hold cards that are part of a pair or better
      for (let i = 0; i < 5; i++) {
        if (dCounts[dealerHand[i].rank] > 1) dealerHeld[i] = true;
      }
      // If nothing to hold, hold highest card, draw up to 3 new
      if (dealerEval.rank === 0) {
        let maxRank = Math.max(...dealerHand.map(c => c.rank));
        let idx = dealerHand.findIndex(c => c.rank === maxRank);
        dealerHeld[idx] = true;
      }
      for (let i = 0; i < 5; i++) {
        if (!dealerHeld[i]) dealerHand[i] = deck.pop();
      }

      // Show result
      renderHand(playerHand, 'player-hand', false);
      renderDealerHand(false);
      let playerScore = evaluateHand(playerHand);
      let dealerScore = evaluateHand(dealerHand);
      let resultMsg = `Your Hand: ${playerScore.name} | Dealer: ${dealerScore.name}. `;
      let win = false, push = false;
      if (playerScore.rank > dealerScore.rank) win = true;
      else if (playerScore.rank === dealerScore.rank) {
        // Tiebreak: highest card
        let pRanks = playerHand.map(c => c.rank).sort((a,b)=>b-a);
        let dRanks = dealerHand.map(c => c.rank).sort((a,b)=>b-a);
        for (let i = 0; i < 5; i++) {
          if (pRanks[i] > dRanks[i]) { win = true; break; }
          if (pRanks[i] < dRanks[i]) { win = false; break; }
        }
        if (!win) push = true;
      }
      if (win) {
        let payout = currentBet * PAYOUTS[Math.max(playerScore.rank,1)];
        playerBalance += currentBet + payout;
        resultMsg += `You win! Payout: $${payout}`;
      } else if (push) {
        playerBalance += currentBet;
        resultMsg += "It's a tie. Bet returned.";
      } else {
        resultMsg += "Dealer wins. You lose your bet.";
      }
      currentBet = 0;
      updateBalances();
      setMessage(resultMsg);
      gameState = 'finished';
      document.getElementById('draw-controls').classList.add('hidden');
      document.getElementById('next-controls').classList.remove('hidden');
    }

    function nextRound() {
      if (playerBalance < 1) {
        setMessage("You're out of balance! Refresh to restart.");
        document.getElementById('bet-controls').classList.add('hidden');
        document.getElementById('draw-controls').classList.add('hidden');
        document.getElementById('next-controls').classList.add('hidden');
        return;
      }
      document.getElementById('bet-amount').max = playerBalance;
      document.getElementById('bet-controls').classList.remove('hidden');
      document.getElementById('draw-controls').classList.add('hidden');
      document.getElementById('next-controls').classList.add('hidden');
      setMessage("Place your bet to begin.");
      document.getElementById('player-hand').innerHTML = '';
      document.getElementById('dealer-hand').innerHTML = '';
    }

    // Start
    nextRound();
  </script>
</body>
</html>
